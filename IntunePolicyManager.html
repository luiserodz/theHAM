<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intune Policy Manager</title>
    <link rel="stylesheet" href="intune-policy-manager.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="status-indicator">
                <span class="status-dot" id="statusDot"></span>
                <span id="connectionStatus" role="status" aria-live="polite">Disconnected</span>
            </div>
            <div class="header-title">
                <h1>
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                    </svg>
                    Intune Policy Manager
                </h1>
                <button id="signOutBtn" class="btn btn-danger" style="display: none;" aria-label="Sign out">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                        <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                    </svg>
                    Sign Out
                </button>
            </div>
            <p>Upload and manage Microsoft Intune configuration policies</p>
            
            <div class="warning-box" style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 20px; margin-top: 15px;">
                <div class="warning-content">
                    <div class="warning-icon">⚠️</div>
                    <div class="warning-details">
                        <div class="warning-title">
                            Critical Warning: This tool can modify and delete Intune policies
                        </div>
                        <ul class="warning-list">
                            <li><strong>Always backup policies</strong> before making any changes</li>
                            <li><strong>Test in a non-production environment</strong> first to avoid disrupting users</li>
                            <li><strong>Deleted policies cannot be recovered</strong> - deletions are <span class="warning-highlight">permanent</span></li>
                            <li><strong>Unassigning policies may affect device configurations</strong> immediately</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-tabs" role="tablist">
            <button class="nav-tab active" role="tab" aria-selected="true" aria-controls="uploadTab" onclick="IntunePolicyManager.switchTab('upload')">
                Upload Policies
            </button>
            <button class="nav-tab" role="tab" aria-selected="false" aria-controls="manageTab" onclick="IntunePolicyManager.switchTab('manage')">
                Manage Policies
            </button>
        </div>

        <!-- How to Get Client ID Section -->
        <div style="background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 0; margin-bottom: 20px;">
            <button class="collapsible" id="howToToggle" aria-expanded="false" aria-controls="howToContent">
                <span>How to Get Your Entra ID Client ID</span>
            </button>
            <div class="collapsible-content" id="howToContent">
                <div style="padding: 20px; background: #f0f8ff; border: 2px solid #2a5298; border-radius: 0 0 8px 8px;">
                    <h3 style="color: #2a5298; margin-bottom: 15px;">Step-by-Step Guide to Register Your Application</h3>
                    
                    <div class="alert alert-warning">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                        </svg>
                        <strong>Dynamic Environment Warning:</strong> If you're running this in Google Colab, JSFiddle, or similar platforms, the redirect URI changes each time. You'll need to update it in Entra ID before each use.
                    </div>
                    
                    <div class="setup-section">
                        <h4>Step 1: Register an Application in Entra ID</h4>
                        <ol>
                            <li>Go to the <a href="https://entra.microsoft.com" target="_blank" rel="noopener">Microsoft Entra Portal</a></li>
                            <li>Navigate to <strong>Applications</strong> → <strong>App registrations</strong></li>
                            <li>Click <strong>New registration</strong></li>
                            <li>Configure the application:
                                <ul>
                                    <li><strong>Name:</strong> Intune Policy Manager</li>
                                    <li><strong>Supported account types:</strong> Choose based on your needs:
                                        <ul>
                                            <li>"Accounts in this organizational directory only" (single tenant)</li>
                                            <li>"Accounts in any organizational directory" (multi-tenant)</li>
                                        </ul>
                                    </li>
                                    <li><strong>Redirect URI:</strong>
                                        <ul>
                                            <li>Platform: <code>Single-page application (SPA)</code></li>
                                            <li>URI: <code id="redirectUriDisplay">Loading...</code> <button class="btn btn-info" style="padding: 5px 10px; font-size: 12px;" onclick="IntunePolicyManager.copyRedirectUri()">Copy</button></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>Click <strong>Register</strong></li>
                        </ol>
                    </div>

                    <div class="setup-section">
                        <h4>Step 2: Configure API Permissions</h4>
                        <ol>
                            <li>In your app registration, go to <strong>API permissions</strong></li>
                            <li>Click <strong>Add a permission</strong> → <strong>Microsoft Graph</strong> → <strong>Delegated permissions</strong></li>
                            <li>Search for and add these permissions:
                                <ul>
                                    <li><code>DeviceManagementConfiguration.ReadWrite.All</code> - Required for managing policies</li>
                                    <li><code>DeviceManagementApps.ReadWrite.All</code> - For app policies</li>
                                    <li><code>DeviceManagementServiceConfig.ReadWrite.All</code> - For service configurations</li>
                                    <li><code>Group.Read.All</code> - To read group names for assignments</li>
                                    <li><code>User.Read</code> - To sign in</li>
                                </ul>
                            </li>
                            <li><strong style="color: red;">Important:</strong> Click <strong>Grant admin consent</strong></li>
                            <li>Ensure all permissions show a green checkmark under "Status"</li>
                        </ol>
                    </div>

                    <div class="setup-section">
                        <h4>Step 3: Get Your Client ID</h4>
                        <ol>
                            <li>Go to the <strong>Overview</strong> page</li>
                            <li>Copy the <strong>Application (client) ID</strong> (it looks like: <code>xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</code>)</li>
                            <li>Paste it in the Client ID field below</li>
                        </ol>
                    </div>

                    <div class="setup-section">
                        <h4>Step 4: Managing Dynamic Redirect URIs</h4>
                        <ol>
                            <li>If using this tool in a dynamic environment (like Google Colab), you'll need to update the redirect URI each time</li>
                            <li>Go to <strong>Authentication</strong> in your app registration</li>
                            <li>Under <strong>Single-page application</strong>, add the new redirect URI shown above</li>
                            <li>Remove old redirect URIs that are no longer needed</li>
                            <li>Click <strong>Save</strong></li>
                        </ol>
                    </div>

                    <div class="setup-section" style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-top: 20px;">
                        <h4 style="margin-top: 0;">Alternative: Use a Static Hosting Service</h4>
                        <p style="margin-bottom: 10px;">To avoid changing the redirect URI each time, consider hosting this HTML file on:</p>
                        <ul style="margin-bottom: 10px;">
                            <li>GitHub Pages (free)</li>
                            <li>Netlify (free tier available)</li>
                            <li>Microsoft Azure Static Web Apps (free tier available)</li>
                            <li>Your own web server</li>
                        </ul>
                        <p style="margin-bottom: 0;">This way, you'll have a permanent URL that doesn't change.</p>
                    </div>

                    <div class="setup-section" style="background: #d1ecf1; padding: 15px; border-radius: 5px; margin-top: 20px;">
                        <h4 style="margin-top: 0; color: #0c5460;">Important Notes:</h4>
                        <ul style="margin-bottom: 0;">
                            <li>The redirect URI must match <strong>exactly</strong> - including protocol (http/https) and any trailing slashes</li>
                            <li>Admin consent is required for the Graph API permissions</li>
                            <li>The Client ID is safe to share - authentication still requires user credentials</li>
                            <li>For production use, always use HTTPS</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert for sandboxed environments -->
        <div class="alert alert-warning" id="sandboxWarning" style="display: none;">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
            </svg>
            <div>
                <strong>Sandboxed Environment Detected!</strong>
                <p>Some features may not work in this environment:</p>
                <ul>
                    <li>Authentication popups may be blocked</li>
                    <li>Download this HTML file and run it locally for full functionality</li>
                </ul>
            </div>
        </div>

        <!-- Upload Tab -->
        <div class="tab-content active" id="uploadTab" role="tabpanel">
            <div class="auth-section">
                <h3>Authentication</h3>
                <div class="form-group">
                    <label for="clientId">Entra ID Client ID:</label>
                    <input type="text" id="clientId" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" 
                           pattern="[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}"
                           aria-describedby="clientIdHelp">
                    <small id="clientIdHelp" class="visually-hidden">Enter your Azure AD application client ID in GUID format</small>
                </div>
                <div id="authStatus" class="auth-status disconnected" role="status" aria-live="polite">
                    <span>Not connected to Microsoft Graph</span>
                    <span id="tokenExpiry" style="font-size: 0.875rem;"></span>
                </div>
                <button id="loginBtn" class="btn btn-primary" disabled aria-label="Sign in with Microsoft">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    Sign in with Microsoft
                </button>
                <div id="userInfo" style="display: none;">
                    <strong>Signed in as:</strong> <span id="userEmail"></span>
                </div>
            </div>

            <div style="margin-top: 30px;">
                <h3>Upload Policies from JSON</h3>
                <div class="form-group">
                    <div class="file-input-wrapper">
                        <button class="btn btn-secondary" aria-label="Choose policy files">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                            </svg>
                            Load Policy JSON Files
                        </button>
                        <input type="file" id="policyFiles" multiple accept=".json" aria-label="Select policy files">
                    </div>
                    <small style="display: block; margin-top: 5px; color: #666;">Select one or more JSON policy files</small>
                </div>

                <div id="uploadList" style="display: none; margin-top: 20px;">
                    <h4>Policies to Upload: <span id="uploadCount">0</span></h4>
                    <div id="uploadPolicyList" class="policy-list" style="max-height: 300px;"></div>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label for="policyPrefix">Name Prefix (optional):</label>
                        <input type="text" id="policyPrefix" placeholder="e.g., 'TEST - '">
                    </div>
                    
                    <div class="form-group">
                        <label>Assignment Target:</label>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="assignmentTarget" value="none" checked>
                                No Assignment
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="assignmentTarget" value="allUsers">
                                All Users
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="assignmentTarget" value="allDevices">
                                All Devices
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="assignmentTarget" value="group">
                                Specific Group
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group" id="groupSelectionContainer" style="display: none;">
                        <label for="groupSearch">Search for Group:</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="groupSearch" placeholder="Enter group name...">
                            <button class="btn btn-info" onclick="IntunePolicyManager.searchGroups()">Search</button>
                        </div>
                        <select id="groupSelect" style="margin-top: 10px; display: none;">
                            <option value="">Select a group...</option>
                        </select>
                        <div id="selectedGroupInfo" style="margin-top: 10px; padding: 10px; background: #e3f2fd; border-radius: 5px; display: none;">
                            <strong>Selected Group:</strong> <span id="selectedGroupName"></span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="IntunePolicyManager.selectAllUpload()">Select All</button>
                        <button class="btn btn-secondary" onclick="IntunePolicyManager.deselectAllUpload()">Deselect All</button>
                        <button id="uploadSelectedBtn" class="btn btn-success" disabled>
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                            </svg>
                            Upload Selected Policies
                        </button>
                    </div>
                </div>

                <div class="progress-section" id="uploadProgress">
                    <h3>Upload Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="uploadProgressFill"></div>
                        <div class="progress-text" id="uploadProgressText">0%</div>
                    </div>
                    <p id="uploadProgressDetails" style="margin-top: 10px; text-align: center;">Preparing upload...</p>
                </div>

                <div class="results-section" id="uploadResults">
                    <h3>Upload Results</h3>
                    <div style="margin-bottom: 10px;">
                        <button class="btn btn-secondary" onclick="IntunePolicyManager.exportResults('upload')">Export Results</button>
                        <button class="btn btn-secondary" onclick="IntunePolicyManager.clearResults('upload')">Clear Results</button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Policy Name</th>
                                    <th>Status</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="uploadResultsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Tab -->
        <div class="tab-content" id="manageTab" role="tabpanel">
            <h3>Manage Existing Policies</h3>
            
            <div class="stats-cards" id="policyStats" style="display: none;">
                <div class="stats-card">
                    <h4 id="totalPoliciesCount">0</h4>
                    <p>Total Policies</p>
                </div>
                <div class="stats-card">
                    <h4 id="configPoliciesCount">0</h4>
                    <p>Configuration Policies</p>
                </div>
                <div class="stats-card">
                    <h4 id="compliancePoliciesCount">0</h4>
                    <p>Compliance Policies</p>
                </div>
                <div class="stats-card">
                    <h4 id="selectedPoliciesCount">0</h4>
                    <p>Selected</p>
                </div>
            </div>
            
            <div class="filter-controls">
                <input type="text" id="manageSearchInput" placeholder="Search policies..." aria-label="Search policies">
                <select id="policyTypeFilter" aria-label="Filter by policy type">
                    <option value="">All Types</option>
                    <option value="configurationPolicies">Configuration Policies</option>
                    <option value="deviceConfigurations">Device Configurations</option>
                    <option value="compliancePolicies">Compliance Policies</option>
                    <option value="groupPolicyConfigurations">Group Policies</option>
                    <option value="intentPolicies">Intent Policies</option>
                </select>
                <label style="display: flex; align-items: center; gap: 5px; margin-left: 10px;">
                    <input type="checkbox" id="showAssignmentsOnly">
                    Show only policies with assignments
                </label>
                <button class="btn btn-info" onclick="IntunePolicyManager.refreshPolicies()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                    </svg>
                    Refresh
                </button>
                <span class="filter-stats" id="manageFilterStats"></span>
            </div>

            <div id="managePolicyList" class="policy-list">
                <div class="empty-state">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <h3>No Policies Loaded</h3>
                    <p>Sign in and click "Refresh" to load existing policies</p>
                </div>
            </div>

            <div style="margin-top: 20px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h4 style="margin-bottom: 15px;">Actions for Selected Policies</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="IntunePolicyManager.selectAllManage()">Select All</button>
                    <button class="btn btn-secondary" onclick="IntunePolicyManager.deselectAllManage()">Deselect All</button>
                    <div style="width: 100%; height: 1px; background: #dee2e6; margin: 10px 0;"></div>
                    <button class="btn btn-primary" onclick="IntunePolicyManager.exportSelected()" disabled id="exportSelectedBtn">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                            <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                        </svg>
                        Export Selected
                    </button>
                    <button class="btn btn-success" onclick="IntunePolicyManager.duplicateSelected()" disabled id="duplicateSelectedBtn">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2 0v8h8V2H6zM2 6a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-2h-2v2H2V8h2V6H2z"/>
                        </svg>
                        Duplicate Selected
                    </button>
                    <button class="btn btn-info" onclick="IntunePolicyManager.assignSelected()" disabled id="assignBtn">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A31.493 31.493 0 0 1 8 14.58a31.481 31.481 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94zM8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10z"/>
                            <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                        </svg>
                        Assign Selected
                    </button>
                    <button class="btn btn-warning" onclick="IntunePolicyManager.unassignSelected()" disabled id="unassignBtn">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M12.354 4.354a.5.5 0 0 0-.708-.708L8 7.293 4.354 3.646a.5.5 0 1 0-.708.708L7.293 8l-3.647 3.646a.5.5 0 0 0 .708.708L8 8.707l3.646 3.647a.5.5 0 0 0 .708-.708L8.707 8l3.647-3.646z"/>
                        </svg>
                        Remove All Assignments
                    </button>
                    <button class="btn btn-danger" onclick="IntunePolicyManager.deleteSelected()" disabled id="deleteSelectedBtn">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
                        </svg>
                        Delete Selected
                    </button>
                </div>
                <div class="alert alert-warning" style="margin-top: 15px;">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                    </svg>
                    <div>
                        <strong>Warning:</strong> Delete and unassign actions cannot be undone. Always backup policies before making changes.
                    </div>
                </div>
            </div>

            <div class="progress-section" id="deleteProgress">
                <h3>Operation Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="deleteProgressFill"></div>
                    <div class="progress-text" id="deleteProgressText">0%</div>
                </div>
                <p id="deleteProgressDetails" style="margin-top: 10px; text-align: center;">Processing...</p>
            </div>

            <div class="results-section" id="deleteResults">
                <h3>Operation Results</h3>
                <div style="margin-bottom: 10px;">
                    <button class="btn btn-secondary" onclick="IntunePolicyManager.exportResults('delete')">Export Results</button>
                    <button class="btn btn-secondary" onclick="IntunePolicyManager.clearResults('delete')">Clear Results</button>
                </div>
                <div style="max-height: 400px; overflow-y: auto;">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Policy Name</th>
                                <th>Status</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="deleteResultsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Assignment Modal -->
    <div id="assignmentModal" class="confirmation-modal" aria-hidden="true" role="dialog" tabindex="-1">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" style="font-weight: 600; color: #1e3c72;">Assign Policies to Target</div>
            <div class="modal-body">
                <p style="margin-bottom: 20px;">Select assignment target for <span id="assignmentPolicyCount">0</span> selected policies:</p>
                
                <div class="form-group">
                    <label>Assignment Target:</label>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="radio" name="manageAssignmentTarget" value="allUsers" checked>
                            All Users
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="radio" name="manageAssignmentTarget" value="allDevices">
                            All Devices
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="radio" name="manageAssignmentTarget" value="group">
                            Specific Group
                        </label>
                    </div>
                </div>
                
                <div class="form-group" id="manageGroupSelectionContainer" style="display: none; margin-top: 20px;">
                    <label for="manageGroupSearch">Search for Group:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="manageGroupSearch" placeholder="Enter group name..." style="flex: 1;">
                        <button class="btn btn-info" onclick="IntunePolicyManager.searchManageGroups()">Search</button>
                    </div>
                    <select id="manageGroupSelect" style="margin-top: 10px; display: none; width: 100%;">
                        <option value="">Select a group...</option>
                    </select>
                    <div id="manageSelectedGroupInfo" style="margin-top: 10px; padding: 10px; background: #e3f2fd; border-radius: 5px; display: none;">
                        <strong>Selected Group:</strong> <span id="manageSelectedGroupName"></span>
                    </div>
                </div>
                
                <div class="alert alert-info" style="margin-top: 20px;">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                    </svg>
                    <div>
                        <strong>Note:</strong> This will add the selected assignment to existing policies. It will not replace existing assignments.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="IntunePolicyManager.closeAssignmentModal()">Cancel</button>
                <button class="btn btn-success" id="confirmAssignBtn" onclick="IntunePolicyManager.confirmAssignment()">Assign Policies</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="confirmation-modal" aria-hidden="true" role="dialog" tabindex="-1" aria-labelledby="modalHeader">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">Confirm Action</div>
            <div class="modal-body" id="modalBody">Are you sure you want to proceed?</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelModalBtn">Cancel</button>
                <button class="btn btn-danger" id="confirmBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Policy Viewer Modal -->
    <div id="policyViewer" class="policy-viewer" role="dialog" aria-labelledby="policyViewerTitle" tabindex="-1">
        <div class="policy-viewer-content">
            <div class="policy-viewer-header">
                <h3 id="policyViewerTitle">Policy Details</h3>
                <button class="btn btn-secondary" onclick="IntunePolicyManager.closePolicyViewer()">Close</button>
            </div>
            <div class="policy-viewer-body">
                <pre id="policyViewerContent"></pre>
            </div>
        </div>
    </div>

    <!-- Include MSAL library -->
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js" defer></script>
    
    <!-- Include JSZip library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
    
<script src="intune-policy-manager.js" defer></script>
</body>
</html>
